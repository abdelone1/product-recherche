<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Research Tool - Facebook Ads Analyzer</title>
    <meta name="description"
        content="Outil gratuit pour analyser la Facebook Ads Library et trouver des produits rentables √† vendre en Afrique">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Login Overlay -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <h2>üîê Connexion</h2>
            <p>Entrez vos identifiants pour acc√©der √† l'outil.</p>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">Nom d'utilisateur</label>
                    <input type="text" id="loginUsername" placeholder="abdel ou yousf" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <p class="login-error" id="loginError" style="display:none; color: #e74c3c;">Identifiants incorrects</p>
                <button type="submit" class="btn btn-primary" style="width:100%;">Se Connecter</button>
            </form>
        </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">üîç</span>
                <span class="logo-text">Product<span class="accent">Finder</span></span>
            </div>
            <button class="collapse-btn" id="sidebarCollapseBtn" title="R√©duire la barre lat√©rale">¬´</button>
        </div>

        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" data-section="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Dashboard</span>
            </a>
            <a href="#add-product" class="nav-item" data-section="add-product">
                <span class="nav-icon">‚ûï</span>
                <span class="nav-text">Ajouter Produit</span>
            </a>
            <a href="#products" class="nav-item" data-section="products">
                <span class="nav-icon">üì¶</span>
                <span class="nav-text">Mes Produits</span>
            </a>
            <a href="#declined-products" class="nav-item" data-section="declined-products">
                <span class="nav-icon">‚ùå</span>
                <span class="nav-text">Produits D√©clin√©s</span>
            </a>
            <a href="#completed-products" class="nav-item" data-section="completed-products">
                <span class="nav-icon">‚è≥</span>
                <span class="nav-text">Produits √† compl√©ter</span>
            </a>
            <a href="#validated-products" class="nav-item" data-section="validated-products">
                <span class="nav-icon">‚úÖ</span>
                <span class="nav-text">Produits Valid√©s</span>
            </a>
            <a href="#ready-for-ads" class="nav-item" data-section="ready-for-ads">
                <span class="nav-icon">üöÄ</span>
                <span class="nav-text">Pr√™ts √† Tester</span>
            </a>
            <a href="#facebook-ads" class="nav-item" data-section="facebook-ads">
                <span class="nav-icon">üì±</span>
                <span class="nav-text">Facebook Ads</span>
            </a>
            <a href="#simulator" class="nav-item" data-section="simulator">
                <span class="nav-icon">üßÆ</span>
                <span class="nav-text">Simulateur COD</span>
            </a>
            <a href="#settings" class="nav-item" data-section="settings">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">Param√®tres</span>
            </a>
            <a href="#history" class="nav-item" data-section="history">
                <span class="nav-icon">üìú</span>
                <span class="nav-text">Historique</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="export-btn" id="exportBtn">
                <span>üì•</span> Exporter CSV
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <button class="menu-toggle" id="menuToggle">‚ò∞</button>
            <div class="header-title">
                <h1 id="pageTitle">Dashboard</h1>
                <p class="header-subtitle" id="pageSubtitle">Vue d'ensemble de vos produits</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" id="forceRefreshBtn" title="Vider le cache et recharger"
                    style="padding: 8px 12px; margin-right: 8px;">
                    üîÑ Actualiser
                </button>
                <button class="btn btn-secondary" id="logoutBtn" title="D√©connexion"
                    style="padding: 8px 12px; margin-right: 8px;">
                    üö™
                </button>
                <span class="user-badge" id="currentUserBadge"
                    style="margin-right: 10px; padding: 5px 12px; background: var(--primary); color: white; border-radius: 20px; font-size: 0.85rem;"></span>
                <button class="btn btn-primary" id="quickAddBtn">
                    <span>+</span> Ajouter Produit
                </button>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section class="section" id="dashboard-section">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">üì¶</div>
                    <div class="stat-info">
                        <span class="stat-value" id="totalProducts">0</span>
                        <span class="stat-label">Total Produits</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">üìÖ</div>
                    <div class="stat-info">
                        <span class="stat-value" id="todayProducts">0</span>
                        <span class="stat-label">Aujourd'hui</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple">‚≠ê</div>
                    <div class="stat-info">
                        <span class="stat-value" id="avgScore">0</span>
                        <span class="stat-label">Score Moyen</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">üí∞</div>
                    <div class="stat-info">
                        <span class="stat-value" id="avgProfit">$0</span>
                        <span class="stat-label">Profit Moyen</span>
                    </div>
                </div>
            </div>

            <!-- Recent Products -->
            <div class="card">
                <div class="card-header">
                    <h2>Produits R√©cents</h2>
                    <a href="#products" class="link" data-section="products">Voir tout ‚Üí</a>
                </div>
                <div class="table-container">
                    <table class="table" id="recentProductsTable">
                        <thead>
                            <tr>
                                <th>Produit</th>
                                <th>Date</th>
                                <th>R√©seaux</th>
                                <th>Prix Achat</th>
                                <th>Prix Vente</th>
                                <th>Profit</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="recentProductsBody">
                            <!-- Products will be inserted here -->
                        </tbody>
                    </table>
                    <div class="empty-state" id="emptyDashboard">
                        <span class="empty-icon">üì¶</span>
                        <p>Aucun produit ajout√©</p>
                        <button class="btn btn-secondary" data-section="add-product">Ajouter votre premier
                            produit</button>
                    </div>
                </div>
            </div>

            <!-- Top Products by Score -->
            <div class="card">
                <div class="card-header">
                    <h2>üèÜ Top Produits</h2>
                </div>
                <div class="top-products-grid" id="topProductsGrid">
                    <!-- Top products will be inserted here -->
                </div>
                <div class="empty-state" id="emptyTopProducts" style="display: none;">
                    <span class="empty-icon">üèÜ</span>
                    <p>Ajoutez des produits pour voir le classement</p>
                </div>
            </div>
        </section>

        <!-- Add Product Section -->
        <section class="section hidden" id="add-product-section">
            <div class="form-container">
                <div class="card">
                    <div class="card-header">
                        <h2>‚ûï Ajouter un Nouveau Produit</h2>
                    </div>
                    <form id="productForm" class="product-form">
                        <!-- Basic Info -->
                        <div class="form-group">
                            <label for="productName">Nom du Produit *</label>
                            <input type="text" id="productName" required placeholder="Ex: Lampe LED Rechargeable">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="buyPrice">Prix d'Achat (USD) *</label>
                                <input type="number" id="buyPrice" required step="0.01" min="0" placeholder="5.00">
                            </div>
                            <div class="form-group">
                                <label for="sellPrice">Prix de Vente (USD) *</label>
                                <input type="number" id="sellPrice" required step="0.01" min="0" placeholder="15.00">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="weight">Poids (grammes)</label>
                                <input type="number" id="weight" step="1" min="0" placeholder="350">
                            </div>
                            <div class="form-group">
                                <label for="productLink">Lien Produit (L'image sera d√©tect√©e auto.)</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="url" id="productLink" placeholder="Collez le lien ici..."
                                        onblur="detectProductImage(this.value, 'imagePreview')">
                                    <button type="button" class="btn btn-secondary"
                                        onclick="detectProductImage(document.getElementById('productLink').value, 'imagePreview')"
                                        title="Chercher l'image">üîé</button>
                                </div>
                                <input type="hidden" id="productImage">
                                <div class="image-preview-container" id="imagePreview">
                                    <span class="image-preview-text">Collez le lien et cliquez sur üîé</span>
                                </div>
                            </div>
                        </div>

                        <!-- Countries Selection -->
                        <div class="form-group">
                            <label>Pays Cibles</label>
                            <div class="countries-grid" id="countriesGrid">
                                <!-- Countries will be inserted here -->
                            </div>
                        </div>

                        <!-- Criteria Scoring -->
                        <div class="form-group">
                            <label>Crit√®res de Scoring</label>
                            <div class="criteria-grid">
                                <label class="checkbox-card">
                                    <input type="checkbox" id="criteriaAudience">
                                    <span class="checkbox-content">
                                        <span class="checkbox-icon">üë•</span>
                                        <span class="checkbox-text">Large Audience</span>
                                        <span class="checkbox-points">+15 pts</span>
                                    </span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" id="criteriaProblem">
                                    <span class="checkbox-content">
                                        <span class="checkbox-icon">üîß</span>
                                        <span class="checkbox-text">R√©sout un probl√®me</span>
                                        <span class="checkbox-points">+20 pts</span>
                                    </span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" id="criteriaWow">
                                    <span class="checkbox-content">
                                        <span class="checkbox-icon">‚ú®</span>
                                        <span class="checkbox-text">Effet "Wow"</span>
                                        <span class="checkbox-points">+15 pts</span>
                                    </span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" id="criteriaCompetition">
                                    <span class="checkbox-content">
                                        <span class="checkbox-icon">üéØ</span>
                                        <span class="checkbox-text">Faible Concurrence</span>
                                        <span class="checkbox-points">+15 pts</span>
                                    </span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" id="criteriaUpsell">
                                    <span class="checkbox-content">
                                        <span class="checkbox-icon">üìà</span>
                                        <span class="checkbox-text">Possibilit√© d'Upsell</span>
                                        <span class="checkbox-points">+10 pts</span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <textarea id="notes" rows="3"
                                placeholder="Observations, id√©es de marketing, etc."></textarea>
                        </div>

                        <!-- Live Score Preview -->
                        <div class="score-preview" id="scorePreview">
                            <div class="score-circle">
                                <span class="score-value" id="previewScore">0</span>
                                <span class="score-max">/100</span>
                            </div>
                            <div class="score-details">
                                <div class="score-grade" id="previewGrade">D</div>
                                <div class="profit-preview">
                                    <span class="profit-label">Profit Estim√©:</span>
                                    <span class="profit-value" id="previewProfit">$0.00</span>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="form-actions">
                            <button type="reset" class="btn btn-secondary">R√©initialiser</button>
                            <button type="submit" class="btn btn-primary">üíæ Sauvegarder Produit</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Products List Section -->
        <section class="section hidden" id="products-section">
            <div class="card">
                <div class="card-header">
                    <h2>üì¶ Tous les Produits</h2>
                    <div class="header-controls">
                        <input type="text" id="searchProducts" class="search-input" placeholder="üîç Rechercher...">
                        <select id="filterScore" class="filter-select">
                            <option value="all">Tous les scores</option>
                            <option value="A">Score A (80-100)</option>
                            <option value="B">Score B (60-79)</option>
                            <option value="C">Score C (40-59)</option>
                            <option value="D">Score D (0-39)</option>
                        </select>
                        <div class="currency-toggle">
                            <button class="currency-btn active" data-currency="USD" onclick="setCurrency('USD')">$
                                USD</button>
                            <button class="currency-btn" data-currency="CFA" onclick="setCurrency('CFA')">CFA</button>
                            <button class="currency-btn" data-currency="MAD" onclick="setCurrency('MAD')">MAD</button>
                            <button class="currency-btn" data-currency="EUR" onclick="setCurrency('EUR')">‚Ç¨ EUR</button>
                        </div>
                    </div>
                </div>

                <!-- Product Count Display -->
                <div class="product-count-bar"
                    style="padding: 12px 24px; background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                    <span id="activeProductCount" style="color: var(--text-secondary); font-size: 14px;">0 produits
                        affich√©s</span>
                </div>

                <div class="table-container">
                    <table class="table" id="allProductsTable">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Produit</th>
                                <th>Date</th>
                                <th>R√©seaux</th>
                                <th>Produit Choisi</th>
                                <th>Prix Achat</th>
                                <th>Poids</th>
                                <th>Vente Min. (Rec)</th>
                                <th>Profit Cible ($)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="allProductsBody">
                            <!-- Products will be inserted here -->
                        </tbody>
                    </table>
                    <div class="empty-state" id="emptyProducts">
                        <span class="empty-icon">üì¶</span>
                        <p>Aucun produit trouv√©</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Validated Products Section -->
        <section class="section hidden" id="validated-products-section">
            <div class="card">
                <div class="card-header">
                    <h2>‚úÖ Produits Valid√©s (Gagnants)</h2>
                    <div class="header-actions">
                        <span class="badge badge-success" id="validatedCount">0 produits</span>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table" id="validatedProductsTable">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Produit</th>
                                <th>Date</th>
                                <th>Commentaire</th>
                                <th>Produit Choisi</th>
                                <th>Prix Achat</th>
                                <th>Poids</th>
                                <th>Vente Min. (Rec)</th>
                                <th>Profit Cible ($)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="validatedProductsBody">
                            <!-- Products will be inserted here -->
                        </tbody>
                    </table>
                    <div class="empty-state" id="emptyValidatedProducts">
                        <span class="empty-icon">üèÜ</span>
                        <p>Aucun produit valid√© pour le moment</p>
                        <p class="empty-hint">Validez des produits depuis votre liste "Mes Produits"</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Ready for Ads Section -->
        <section class="section hidden" id="ready-for-ads-section">
            <div class="card">
                <div class="card-header">
                    <h2>üöÄ Produits Pr√™ts √† Tester (Ads)</h2>
                    <div class="header-actions">
                        <span class="badge badge-primary" id="readyForAdsCount">0 produits</span>
                        <button class="btn btn-secondary" id="exportGoogleSheetsBtn"
                            title="Exporter pour Google Sheets">
                            üìä Exporter CSV
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table" id="readyForAdsTable">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Campaign</th>
                                <th>Pays</th>
                                <th>Primary Text</th>
                                <th>Headline</th>
                                <th>Media</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="readyForAdsBody">
                            <!-- Products will be inserted here -->
                        </tbody>
                    </table>
                    <div class="empty-state" id="emptyReadyForAds">
                        <span class="empty-icon">üöÄ</span>
                        <p>Aucun produit pr√™t pour le test ads</p>
                        <p class="empty-hint">Pr√©parez des produits valid√©s pour le test depuis "Produits Valid√©s"</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Declined Products Section -->
        <section class="section hidden" id="declined-products-section">
            <div class="card">
                <div class="card-header">
                    <h2>‚ùå Produits D√©clin√©s</h2>
                    <div class="header-actions">
                        <span class="badge badge-danger" id="declinedCount">0 produits</span>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table" id="declinedProductsTable">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Produit</th>
                                <th>Motif du Refus</th>
                                <th>Date du Refus</th>
                                <th>Dernier Prix</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="declinedProductsBody">
                            <!-- Products will be inserted here -->
                        </tbody>
                    </table>
                    <div class="empty-state" id="emptyDeclinedProducts">
                        <span class="empty-icon">üóëÔ∏è</span>
                        <p>Aucun produit d√©clin√©</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Completed Products Section (New) -->
        <section class="section hidden" id="completed-products-section">
            <div class="section-header">
                <h2>‚è≥ Produits √† compl√©ter</h2>
                <div class="header-actions">
                    <span class="badge badge-warning" id="completedCount">0 produits</span>
                </div>
            </div>
            <div class="table-container">
                <table class="table" id="completedProductsTable">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Produit</th>
                            <th>Date</th>
                            <th>Commentaire</th>
                            <th>Produit Choisi</th>
                            <th>Prix Achat</th>
                            <th>Poids</th>
                            <th>Vente Min. (Rec)</th>
                            <th>Profit Cible ($)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="completedProductsBody">
                        <!-- Products will be inserted here -->
                    </tbody>
                </table>
                <div class="empty-state" id="emptyCompletedProducts">
                    <span class="empty-icon">üìù</span>
                    <p>Aucun produit en attente d'information</p>
                </div>
            </div>
        </section>

        <!-- Facebook Ads Library Section -->
        <section class="section hidden" id="facebook-ads-section">
            <div class="card">
                <div class="card-header">
                    <h2>üì± Facebook Ads Library</h2>
                </div>
                <div class="facebook-ads-content">
                    <div class="ads-intro">
                        <p>Utilisez la Facebook Ads Library pour trouver des produits gagnants. Voici comment proc√©der :
                        </p>
                    </div>

                    <div class="ads-steps">
                        <div class="step-card">
                            <span class="step-number">1</span>
                            <h3>Acc√©der √† la Library</h3>
                            <p>Cliquez sur le bouton ci-dessous pour ouvrir Facebook Ads Library</p>
                        </div>
                        <div class="step-card">
                            <span class="step-number">2</span>
                            <h3>Filtrer par Pays</h3>
                            <p>S√©lectionnez les pays africains cibles dans les filtres</p>
                        </div>
                        <div class="step-card">
                            <span class="step-number">3</span>
                            <h3>Rechercher par Vid√©o</h3>
                            <p>Les pubs vid√©o ont souvent de meilleurs produits</p>
                        </div>
                        <div class="step-card">
                            <span class="step-number">4</span>
                            <h3>Analyser & Ajouter</h3>
                            <p>Trouvez un bon produit et ajoutez-le ici</p>
                        </div>
                    </div>

                    <div class="ads-actions">
                        <a href="https://www.facebook.com/ads/library/?active_status=active&ad_type=all&country=ALL&is_targeted_country=false&media_type=video"
                            target="_blank" class="btn btn-facebook">
                            <span>üì±</span> Ouvrir Facebook Ads Library
                        </a>
                    </div>

                    <div class="quick-links">
                        <h3>üåç Liens Rapides par Pays</h3>
                        <div class="country-links" id="countryLinks">
                            <!-- Country links will be inserted here -->
                        </div>
                    </div>

                    <div class="telegram-channels">
                        <h3>üì¢ Channels Telegram Recommand√©s</h3>
                        <div class="channel-links">
                            <a href="https://t.me/topjemlaa" target="_blank" class="channel-link">
                                <span>üì±</span> t.me/topjemlaa
                            </a>
                            <a href="https://t.me/hazargoma" target="_blank" class="channel-link">
                                <span>üì±</span> t.me/hazargoma
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section class="section hidden" id="settings-section">
            <div class="card">
                <div class="card-header">
                    <h2>‚öôÔ∏è Param√®tres</h2>
                </div>
                <div class="settings-content">
                    <div class="setting-group">
                        <h3>üåç Pays Cibles</h3>
                        <p>Modifiez les pays disponibles pour la s√©lection</p>
                        <div class="countries-settings" id="countriesSettings">
                            <!-- Country settings will be inserted here -->
                        </div>

                        <div class="setting-group">
                            <h3>üíæ Donn√©es</h3>
                            <div class="settings-card">
                                <h3>üì¶ Gestion des Donn√©es</h3>
                                <p>G√©rez vos donn√©es locales et exportez-les.</p>
                                <div class="settings-actions">
                                    <button id="backupBtn" class="btn btn-secondary">
                                        <i class="fas fa-file-export"></i> Sauvegarder (JSON)
                                    </button>
                                    <label for="importFile" class="btn btn-secondary">
                                        <i class="fas fa-file-import"></i> Importer
                                    </label>
                                    <input type="file" id="importFile" accept=".json" hidden>

                                    <button id="restoreDemoBtn" class="btn btn-primary"
                                        style="background-color: #8e44ad;">
                                        <i class="fas fa-magic"></i> Restaurer Produits D√©mo
                                    </button>

                                    <button onclick="handleClearData()" class="btn btn-danger">
                                        <i class="fas fa-trash"></i> Tout Effacer
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="setting-group">
                            <h3>‚ÑπÔ∏è √Ä propos</h3>
                            <p>Product Research Tool v1.0</p>
                            <p>Outil gratuit pour identifier les produits prometteurs √† vendre en Afrique.</p>
                        </div>
                    </div>
                </div>
        </section>

        <!-- Simulator COD Section -->
        <section class="section hidden" id="simulator-section">
            <div class="simulator-layout">
                <!-- Left: Form -->
                <div class="simulator-form-panel">
                    <div class="card">
                        <div class="card-header">
                            <h2>üßÆ Simulateur de Profit</h2>
                        </div>

                        <div class="simulator-form">
                            <!-- Buy Price with Currency -->
                            <div class="form-group">
                                <label for="simBuyPrice">Prix d'achat du produit</label>
                                <div class="input-with-currency">
                                    <input type="number" id="simBuyPrice" step="0.01" min="0" placeholder="3"
                                        oninput="autoCalculate()">
                                    <select id="simBuyCurrency" onfocus="this.setAttribute('data-prev', this.value)"
                                        onchange="convertInputCurrency(this, 'simBuyPrice')">
                                        <option value="USD">USD ($)</option>
                                        <option value="CFA">CFA</option>
                                        <option value="MAD">MAD</option>
                                        <option value="GNF">GNF</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Weight -->
                            <div class="form-group">
                                <label for="simWeight">Poids du produit (grammes)</label>
                                <input type="number" id="simWeight" min="0" placeholder="200" oninput="autoCalculate()">
                            </div>

                            <!-- Source -->
                            <div class="form-group">
                                <label for="simSource">Pays de source/provenance</label>
                                <select id="simSource" onchange="autoCalculate()">
                                    <option value="Chine">üá®üá≥ Chine</option>
                                    <option value="Dubai">üá¶üá™ Dubai</option>
                                    <option value="Maroc-Avion">üá≤üá¶ Maroc (Avion)</option>
                                    <option value="Maroc-Camion">üá≤üá¶ Maroc (Camion)</option>
                                </select>
                            </div>

                            <!-- Sell Price with Currency -->
                            <div class="form-group">
                                <label for="simSellPrice">Prix de vente du produit</label>
                                <div class="input-with-currency">
                                    <input type="number" id="simSellPrice" step="1" min="0" placeholder="35"
                                        oninput="autoCalculate()">
                                    <select id="simSellCurrency" onfocus="this.setAttribute('data-prev', this.value)"
                                        onchange="convertInputCurrency(this, 'simSellPrice')">
                                        <option value="USD">USD ($)</option>
                                        <option value="CFA" selected>CFA</option>
                                        <option value="MAD">MAD</option>
                                        <option value="GNF">GNF</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Destination -->
                            <div class="form-group">
                                <label for="simDestination">Pays de destination</label>
                                <select id="simDestination" onchange="autoCalculate()">
                                    <option value="CI">üá®üáÆ C√¥te d'Ivoire</option>
                                    <option value="SN">üá∏üá≥ S√©n√©gal</option>
                                    <option value="BF">üáßüá´ Burkina Faso</option>
                                    <option value="TG">üáπüá¨ Togo</option>
                                    <option value="NE">üá≥üá™ Niger</option>
                                    <option value="ML">üá≤üá± Mali</option>
                                    <option value="BJ">üáßüáØ B√©nin</option>
                                    <option value="GN">üá¨üá≥ Guin√©e Conakry</option>
                                    <option value="TD">üáπüá© Tchad</option>
                                    <option value="GA">üá¨üá¶ Gabon</option>
                                </select>
                            </div>

                            <!-- Quantity -->
                            <div class="form-group">
                                <label for="simQuantity">Quantit√© de produits</label>
                                <input type="number" id="simQuantity" value="1" min="1" oninput="autoCalculate()">
                            </div>

                            <!-- Target Profit -->
                            <div class="form-group target-profit-group">
                                <label for="simTargetProfit">üí∞ Profit Minimum Souhait√© (USD)</label>
                                <div class="input-with-currency">
                                    <input type="number" id="simTargetProfit" step="0.5" min="0" value="5"
                                        placeholder="5" oninput="autoCalculate()">
                                    <select id="simTargetCurrency" onchange="autoCalculate()">
                                        <option value="USD" selected>USD ($)</option>
                                        <option value="EUR">EUR (‚Ç¨)</option>
                                    </select>
                                </div>
                                <small class="form-hint">Le prix de vente minimum sera calcul√© automatiquement</small>
                            </div>

                            <!-- Advanced Parameters (collapsible) -->
                            <div class="advanced-toggle" onclick="toggleAdvanced()">
                                <span>Param√®tres avanc√©s</span>
                                <span id="advancedArrow">‚ñº</span>
                            </div>

                            <div class="advanced-params" id="advancedParams" style="display: none;">
                                <!-- Ad Cost -->
                                <div class="form-group">
                                    <label for="simAdCost">Co√ªt publicit√© par livraison (USD)</label>
                                    <input type="number" id="simAdCost" step="0.01" min="0" value="10" placeholder="10"
                                        oninput="autoCalculate()">
                                    <small class="form-hint">Co√ªt total publicit√© = 10 $ √ó nombre de livraisons</small>
                                </div>

                                <!-- Exchange Rates -->
                                <div class="exchange-rates-edit">
                                    <label>Taux de change pour <span id="destCountryName">C√¥te d'Ivoire</span></label>
                                    <div class="rate-inputs">
                                        <div class="rate-input">
                                            <span>1 MAD =</span>
                                            <input type="number" id="rateMAD" value="66" oninput="autoCalculate()">
                                            <span id="rateCurrency1">CFA</span>
                                        </div>
                                        <div class="rate-input">
                                            <span>1 USD =</span>
                                            <input type="number" id="rateUSD" value="630" oninput="autoCalculate()">
                                            <span id="rateCurrency2">CFA</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Reference -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üì¶ Donn√©es de Configuration</h2>
                            <button class="btn btn-secondary btn-sm" id="toggleShippingData">Voir/Masquer</button>
                        </div>
                        <p class="config-desc">Consultation des donn√©es utilis√©es par le simulateur (lecture seule)</p>
                        <div class="shipping-data-table" id="shippingDataTable" style="display: none;">
                            <div class="data-tabs">
                                <button class="data-tab active" onclick="showDataTab('transport')">Frais de
                                    Transport</button>
                                <button class="data-tab" onclick="showDataTab('exchange')">Taux de Change</button>
                                <button class="data-tab" onclick="showDataTab('delivery')">Frais de Livraison</button>
                            </div>
                            <div id="dataTabContent">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Pays</th>
                                            <th>Source</th>
                                            <th>Type</th>
                                            <th>Valeur</th>
                                            <th>Devise</th>
                                        </tr>
                                    </thead>
                                    <tbody id="shippingDataBody">
                                        <!-- Data will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right: Results -->
                <div class="simulator-results-panel">
                    <div class="card results-card">
                        <div class="card-header">
                            <h2>üìä R√©sultats du Calcul</h2>
                        </div>
                        <div class="results-content">
                            <!-- Main Profit -->
                            <div class="profit-box" id="profitBox">
                                <span class="profit-label">Profit Net Estim√©</span>
                                <span class="profit-value" id="resultProfit">+0.00 USD</span>
                                <span class="profit-status" id="profitStatus">‚úì Profit positif</span>
                            </div>

                            <!-- Revenue -->
                            <div class="result-section">
                                <h4>Revenus</h4>
                                <span class="revenue-value" id="resultRevenue">0.00 USD</span>
                            </div>

                            <!-- Minimum Selling Price -->
                            <div class="result-section min-price-section">
                                <h4>üí∞ Prix de Vente Minimum</h4>
                                <div class="min-price-info">
                                    <span class="min-price-label">Pour un profit de <span id="targetProfitDisplay">5.00
                                            USD</span></span>
                                    <span class="min-price-value" id="minSellPrice">0 CFA</span>
                                    <span class="min-price-usd" id="minSellPriceUSD">(~$0.00 USD)</span>
                                </div>
                            </div>


                            <!-- Cost Breakdown -->
                            <div class="result-section">
                                <h4>Co√ªts D√©taill√©s</h4>
                                <div class="cost-breakdown">
                                    <div class="cost-row">
                                        <span>Co√ªt d'achat:</span>
                                        <span id="costBuy">0.00 USD</span>
                                    </div>
                                    <div class="cost-row">
                                        <span>Co√ªt de transport:</span>
                                        <span id="costTransport">0.00 USD</span>
                                    </div>
                                    <div class="cost-row">
                                        <span>Co√ªt publicit√©:</span>
                                        <span id="costAd">0.00 USD</span>
                                    </div>
                                    <div class="cost-row">
                                        <span>Co√ªt de livraison COD:</span>
                                        <span id="costCOD">0.00 USD</span>
                                    </div>
                                    <div class="cost-row total">
                                        <span>Total des co√ªts:</span>
                                        <span id="costTotal">0.00 USD</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Statistics -->
                            <div class="result-section">
                                <h4>Statistiques</h4>
                                <div class="stats-grid">
                                    <div class="stat-row">
                                        <span>Leads n√©cessaires:</span>
                                        <span id="statLeads">4</span>
                                    </div>
                                    <div class="stat-row">
                                        <span>Commandes confirm√©es:</span>
                                        <span id="statConfirmed">2</span>
                                    </div>
                                    <div class="stat-row">
                                        <span>Produits livr√©s:</span>
                                        <span id="statDelivered">1</span>
                                    </div>
                                    <div class="stat-row">
                                        <span>Taux de livraison effectif:</span>
                                        <span id="statRate">25.0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- History Section -->
        <section class="section hidden" id="history-section">
            <div class="card">
                <div class="card-header">
                    <h2>üìú Historique des Actions</h2>
                    <p>Consultez toutes les modifications effectu√©es sur les produits.</p>
                </div>
                <div class="table-container">
                    <table class="products-table" id="historyTable">
                        <thead>
                            <tr>
                                <th>Date &amp; Heure</th>
                                <th>Utilisateur</th>
                                <th>Action</th>
                                <th>Produit</th>
                            </tr>
                        </thead>
                        <tbody id="historyBody">
                            <!-- History rows will be inserted here -->
                        </tbody>
                    </table>
                    <div class="empty-state" id="emptyHistory" style="display: none;">
                        <div class="empty-icon">üìú</div>
                        <h3>Aucune action enregistr√©e</h3>
                        <p>Les actions sur les produits appara√Ætront ici.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Edit Product Modal -->
    <div class="modal" id="editModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Modifier le Produit</h2>
                <button class="modal-close" id="closeModal">√ó</button>
            </div>
            <form id="editForm" class="product-form">
                <input type="hidden" id="editId">

                <div class="form-group">
                    <label for="editProductName">Nom du Produit *</label>
                    <input type="text" id="editProductName" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editBuyPrice">Prix d'Achat (USD) *</label>
                        <input type="number" id="editBuyPrice" required step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="editSellPrice">Prix de Vente (USD) *</label>
                        <input type="number" id="editSellPrice" required step="0.01" min="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editWeight">Poids (grammes)</label>
                        <input type="number" id="editWeight" step="1" min="0">
                    </div>
                    <div class="form-group">
                        <label for="editProductLink">Lien Produit</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="url" id="editProductLink"
                                onblur="detectProductImage(this.value, 'editImagePreview')">
                            <button type="button" class="btn btn-secondary"
                                onclick="detectProductImage(document.getElementById('editProductLink').value, 'editImagePreview')"
                                title="Chercher l'image">üîé</button>
                        </div>
                        <input type="hidden" id="editProductImage">
                        <div class="image-preview-container" id="editImagePreview">
                            <span class="image-preview-text">Image actuelle</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Pays Cibles</label>
                    <div class="countries-grid" id="editCountriesGrid">
                        <!-- Countries will be inserted here -->
                    </div>
                </div>

                <div class="form-group">
                    <label>Crit√®res de Scoring</label>
                    <div class="criteria-grid">
                        <label class="checkbox-card">
                            <input type="checkbox" id="editCriteriaAudience">
                            <span class="checkbox-content">
                                <span class="checkbox-icon">üë•</span>
                                <span class="checkbox-text">Large Audience</span>
                            </span>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" id="editCriteriaProblem">
                            <span class="checkbox-content">
                                <span class="checkbox-icon">üîß</span>
                                <span class="checkbox-text">R√©sout un probl√®me</span>
                            </span>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" id="editCriteriaWow">
                            <span class="checkbox-content">
                                <span class="checkbox-icon">‚ú®</span>
                                <span class="checkbox-text">Effet "Wow"</span>
                            </span>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" id="editCriteriaCompetition">
                            <span class="checkbox-content">
                                <span class="checkbox-icon">üéØ</span>
                                <span class="checkbox-text">Faible Concurrence</span>
                            </span>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" id="editCriteriaUpsell">
                            <span class="checkbox-content">
                                <span class="checkbox-icon">üìà</span>
                                <span class="checkbox-text">Possibilit√© d'Upsell</span>
                            </span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="editNotes">Notes</label>
                    <textarea id="editNotes" rows="3"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelEdit">Annuler</button>
                    <button type="submit" class="btn btn-primary">üíæ Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Request Info Modal (New) -->
    <div class="modal" id="infoModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2>üìù Demande d'information</h2>
                <button class="modal-close" id="closeInfoModal">√ó</button>
            </div>
            <div style="padding: 24px;">
                <p id="infoProductName" style="margin-bottom: 16px; color: var(--text-secondary);"></p>
                <div class="form-group">
                    <label for="infoComment">Commentaire / Info manquante</label>
                    <textarea id="infoComment" class="form-control" rows="3"
                        placeholder="Ex: Il manque l'image, prix √† v√©rifier..."></textarea>
                </div>
                <div class="form-actions" style="margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" id="cancelInfo">Annuler</button>
                    <button type="button" class="btn btn-warning" id="confirmRequestInfo">Valider la demande</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Comment Modal for Validated Products -->
    <div class="modal" id="commentModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2>üí¨ Commentaire Produit Valid√©</h2>
                <button class="modal-close" id="closeCommentModal">√ó</button>
            </div>
            <div style="padding: 24px;">
                <p id="commentProductName" style="margin-bottom: 16px; color: var(--text-secondary);"></p>
                <div class="form-group">
                    <label for="productComment">Commentaire / Notes</label>
                    <textarea id="productComment" class="form-control" rows="4"
                        placeholder="Ex: Fournisseur confirm√©, stock ok, pr√™t √† lancer..."></textarea>
                </div>
                <div class="form-actions" style="margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" id="cancelComment">Annuler</button>
                    <button type="button" class="btn btn-primary" id="saveComment">üíæ Sauvegarder</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Decline Modal -->
    <div class="modal" id="declineModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2>‚ùå D√©cliner le produit</h2>
                <button class="modal-close" id="closeDeclineModal">√ó</button>
            </div>
            <div style="padding: 24px;">
                <p id="declineProductName" style="margin-bottom: 16px; color: var(--text-secondary);"></p>
                <div class="form-group">
                    <label for="declineReason">Raison (optionnel)</label>
                    <textarea id="declineReason" rows="3"
                        placeholder="Ex: Pas rentable, trop cher, mauvaise qualit√©..."></textarea>
                </div>
                <div class="form-actions" style="margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" id="cancelDecline">Annuler</button>
                    <button type="button" class="btn btn-danger" id="confirmDecline">‚ùå D√©cliner</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ready for Ads Modal -->
    <div class="modal" id="readyForAdsModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 550px;">
            <div class="modal-header">
                <h2>üöÄ Pr√©parer pour Test Ads</h2>
                <button class="modal-close" id="closeReadyForAdsModal">√ó</button>
            </div>
            <div style="padding: 24px;">
                <p id="readyForAdsProductName" style="margin-bottom: 16px; color: var(--text-secondary);"></p>

                <div class="form-row">
                    <div class="form-group">
                        <label for="adCampaignName">Campaign Name (2 mots) *</label>
                        <input type="text" id="adCampaignName" placeholder="Lampe LED" required>
                    </div>
                    <div class="form-group">
                        <label for="adCountry">Pays *</label>
                        <select id="adCountry" required>
                            <option value="">-- Choisir --</option>
                            <option value="CI">üá®üáÆ C√¥te d'Ivoire</option>
                            <option value="SN">üá∏üá≥ S√©n√©gal</option>
                            <option value="BF">üáßüá´ Burkina Faso</option>
                            <option value="TG">üáπüá¨ Togo</option>
                            <option value="NE">üá≥üá™ Niger</option>
                            <option value="ML">üá≤üá± Mali</option>
                            <option value="BJ">üáßüáØ B√©nin</option>
                            <option value="GN">üá¨üá≥ Guin√©e</option>
                            <option value="TD">üáπüá© Tchad</option>
                            <option value="GA">üá¨üá¶ Gabon</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="adWebsiteUrl">Website URL *</label>
                    <input type="url" id="adWebsiteUrl" placeholder="https://votre-boutique.com/produit" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="adImageUrl">Image URL</label>
                        <input type="url" id="adImageUrl" placeholder="https://... (si pas de vid√©o)">
                    </div>
                    <div class="form-group">
                        <label for="adVideoUrl">Video URL</label>
                        <input type="url" id="adVideoUrl" placeholder="https://... (si pas d'image)">
                    </div>
                </div>

                <div class="form-group">
                    <label for="adThumbnailUrl">Video Thumbnail URL (optionnel)</label>
                    <input type="url" id="adThumbnailUrl" placeholder="https://...">
                </div>

                <div class="form-group">
                    <label for="adPrimaryText">Primary Text * (texte principal de la pub)</label>
                    <textarea id="adPrimaryText" rows="3"
                        placeholder="üî• D√©couvrez cette incroyable lampe LED..."></textarea>
                </div>

                <div class="form-group">
                    <label for="adHeadline">Headline * (titre accrocheur)</label>
                    <input type="text" id="adHeadline" placeholder="Offre Limit√©e -50%!">
                </div>

                <div class="form-actions" style="margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" id="cancelReadyForAds">Annuler</button>
                    <button type="button" class="btn btn-primary" id="confirmReadyForAds">üöÄ Pr√©parer pour Test</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span class="toast-icon">‚úì</span>
        <span class="toast-message" id="toastMessage">Action r√©ussie!</span>
    </div>

    <script src="app.js?v=9"></script>
</body>

</html>